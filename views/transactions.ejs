<%  -%>
<div class="card">
  <div class="flex between">
    <h3>Transaction Report</h3>
    <a class="btn" href="/admin/transactions.csv?<%= new URLSearchParams(filters).toString() %>">Export CSV</a>
  </div>
  <form class="filters" method="get">
    <input type="text" name="q" value="<%= filters.q || '' %>" placeholder="Search by order/payment/receipt/email">
    <select name="status">
      <option value="">All Status</option>
      <option <%= filters.status==='created'?'selected':'' %> value="created">created</option>
      <option <%= filters.status==='authorized'?'selected':'' %> value="authorized">authorized</option>
      <option <%= filters.status==='captured'?'selected':'' %> value="captured">captured</option>
      <option <%= filters.status==='failed'?'selected':'' %> value="failed">failed</option>
      <option <%= filters.status==='refunded'?'selected':'' %> value="refunded">refunded</option>
    </select>
    <select name="method">
      <option value="">All Methods</option>
      <option <%= filters.method==='card'?'selected':'' %> value="card">card</option>
      <option <%= filters.method==='upi'?'selected':'' %> value="upi">upi</option>
      <option <%= filters.method==='netbanking'?'selected':'' %> value="netbanking">netbanking</option>
      <option <%= filters.method==='wallet'?'selected':'' %> value="wallet">wallet</option>
    </select>
    <input type="date" name="from" value="<%= filters.from || '' %>">
    <input type="date" name="to" value="<%= filters.to || '' %>">
    <button type="submit">Apply</button>
    <input type="hidden" name="limit" value="<%= pagination.limit %>">
  </form>
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Time</th><th>Order ID</th><th>Payment ID</th><th>Receipt</th><th>Email</th><th>Amount (â‚¹)</th><th>Status</th><th>Method</th>
        </tr>
      </thead>
      <tbody>
        <% txns.forEach(t => { %>
          <tr>
            <td><%= new Date(t.created_at).toLocaleString() %></td>
            <td><%= t.order_id %></td>
            <td><%= t.payment_id || '-' %></td>
            <td><%= t.receipt || '-' %></td>
            <td><%= t.email || '-' %></td>
            <td><%= (t.amount/100).toFixed(2) %></td>
            <td><%= t.status %></td>
            <td><%= t.method || '-' %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
  <%- include('partials/pagination', { pagination, base: '/admin/transactions', extra: filters }) %>
</div>
